const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/header-CYlTcYE_.js","assets/main-DBvVsLpb.js","assets/jquery-DduPepyT.js","assets/vendor-B2AETYxa.js","assets/widev-BwYBS5xR.js"])))=>i.map(i=>d[i]);
import{_}from"./main-DBvVsLpb.js";import{$ as o}from"./jquery-DduPepyT.js";import{d as u,a as y}from"./init-DcKKffQQ.js";import{s as $,d as p,a as U,g as v,b as j,q as I,c as O,w as S,e as B,u as D,f as N,h as F,i as q}from"./firebase-B8KvrrVe.js";import{o as oa,j as ea}from"./firebase-B8KvrrVe.js";import{abrirModal as w,getls as V,Mensaje as b,wiTip as h,wiSpin as g,savels as W,cerrarModal as x}from"./widev-BwYBS5xR.js";import"./vendor-B2AETYxa.js";function X(){const c={db:"smiles",rol:"smile"},k=(a,s,n)=>`<div id="${a}" class="wiModal authMod"><div class="modalBody"><button class="modalX">&times;</button><div class="modalMain"><div class="logo"><img src="./smile.png"></div><h2>${s}</h2><form id="${a.replace("Modal","Form")}">${n}</form></div></div></div>`,d=(a,s,n,f,r=!1)=>`<div class="grupo"><i class="fas fa-${a}"></i><input type="${s}" id="${n}" placeholder="${f}" required>${r?'<i class="fas fa-eye tgPass"></i>':""}</div>`,Y={login:k("loginModal","Login",d("envelope","text","email","Email o usuario")+d("lock","password","password","Contraseña",!0)+'<button type="button" id="Login" class="btnAuth inactivo">Iniciar Sesión</button><div class="links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'),registro:k("registroModal","Crear Cuenta",d("envelope","email","regEmail","Email")+d("user","text","regUsuario","Usuario")+d("user-tie","text","regNombre","Nombre")+d("user-tie","text","regApellidos","Apellidos")+d("lock","password","regPassword","Contraseña",!0)+d("lock","password","regPassword1","Confirmar",!0)+'<div class="grupo grupoCheck"><label><input type="checkbox" id="regTerminos" required><span>Acepto los <a href="/terminos.html" target="_blank" rel="noopener noreferrer">términos y condiciones</a></span></label></div><button type="button" id="Registrar" class="btnAuth inactivo">Registrarme</button><div class="links"><span class="conCuenta">Ya tengo cuenta</span></div>').replace("authMod","authMod regMod"),reset:k("recuperarModal","Restablecer","<p>Ingresa tu Email o usuario:</p>"+d("envelope","text","recEmail","Email o usuario")+'<button type="button" id="Recuperar" class="btnAuth inactivo">Enviar enlace</button><div class="links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>')},z=`.authMod .modalBody{max-width:28vw;min-width:320px;padding:0;background:var(--bg);border-radius:1.5vh;box-shadow:0 10px 40px rgba(0,0,0,.15);animation:mIn .3s ease}@keyframes mIn{from{transform:translateY(-30px) scale(.9);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.regMod .modalBody{max-width:40vw}.modalMain{padding:3vh 2.5vw;display:flex;flex-direction:column;align-items:center}.logo{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:2vh 0 1.5vh;box-shadow:0 8px 24px var(--bxs);background:linear-gradient(135deg,var(--mco),var(--hv));animation:lf 3s ease-in-out infinite}@keyframes lf{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}.logo:hover{transform:scale(1.05) rotate(5deg)}.logo img{width:90%;transition:transform .3s}.logo:hover img{transform:scale(1.1)}h2{font:700 1.8rem var(--ff_P);color:var(--mco);margin:.5vh 0 2vh;text-align:center}form{width:100%;display:flex;flex-direction:column;gap:1.5vh}.grupo{position:relative;width:100%;animation:fiu .4s ease backwards}.grupo:nth-child(n){animation-delay:calc(var(--i, 0) * .05s)}@keyframes fiu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.grupo i{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:var(--mco);opacity:.8;font-size:1.1rem;z-index:2;pointer-events:none;transition:all .3s}.grupo:focus-within i{opacity:1;color:var(--hv);transform:translateY(-50%) scale(1.1)}.tgPass{left:auto!important;right:1rem!important;cursor:pointer;pointer-events:all!important;z-index:3!important;opacity:.6;color:var(--txe)}.tgPass:hover{opacity:1;color:var(--mco);transform:translateY(-50%) scale(1.15)!important}input{width:100%;padding:1.3vh 3.5rem 1.3vh 3rem;border-radius:.8vh;border:1.5px solid var(--bdr);background:var(--wb);color:var(--tx);font-size:.95rem;transition:all .3s;outline:0;box-sizing:border-box}input:hover{border-color:var(--mco);transform:translateY(-1px)}input:focus{border-color:var(--mco);box-shadow:0 0 0 3px var(--bxs),0 4px 12px rgba(0,0,0,.08);transform:translateY(-2px);background:var(--F)}input::placeholder{color:var(--txe);opacity:.6}.btnAuth{width:100%;padding:1.4vh 1.5vw;background:linear-gradient(135deg,var(--mco),var(--hv));color:var(--txa);border:0;border-radius:.8vh;font-weight:600;font-size:1rem;cursor:pointer;box-shadow:0 6px 20px var(--bxs);transition:all .3s;position:relative;overflow:hidden;animation:fiu .4s ease .4s backwards}.btnAuth::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.2);transform:translate(-50%,-50%);transition:width .6s,height .6s}.btnAuth:hover::before{width:300px;height:300px}.btnAuth:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 10px 30px var(--bxs)}.btnAuth:active{transform:translateY(-1px) scale(.98)}.btnAuth.loading{opacity:.8;cursor:wait;pointer-events:none;animation:pul 1.5s ease-in-out infinite}@keyframes pul{0%,100%{opacity:.8}50%{opacity:.6}}.btnAuth.inactivo{opacity:.65;cursor:not-allowed;pointer-events:none;filter:grayscale(40%)}.btnAuth i{margin-right:.3vw;color:var(--bg7)!important}.links{width:100%;display:flex;justify-content:space-between;margin-top:1.5vh;gap:1vh;animation:fiu .4s ease .45s backwards}.links span{color:var(--mco);cursor:pointer;padding:.6vh .8vw;font-size:.95rem;font-weight:500;border-radius:.5vh;transition:all .25s;position:relative}.links span::after{content:'';position:absolute;bottom:0;left:50%;width:0;height:2px;background:var(--mco);transition:all .3s;transform:translateX(-50%)}.links span:hover{color:var(--hv);transform:translateY(-2px)}.links span:hover::after{width:100%}p{color:var(--tx);font-size:.95rem;margin:1.5vh 0 .8vh;opacity:.85;font-weight:500}#registroForm{display:grid;grid-template-columns:1fr 1fr;gap:1.5vh 1.5vw}#registroForm .btnAuth,#registroForm .links{grid-column:1/-1;margin-top:1vh}@media (max-width:1200px){.authMod .modalBody{max-width:35vw}.regMod .modalBody{max-width:50vw}}@media (max-width:768px){.authMod .modalBody{max-width:98vw}.regMod .modalBody{max-width:98vw}.modalMain{padding:2.5vh 5vw}h2{font-size:1.5rem}.logo{width:70px;height:70px}input{padding:1.2vh 3rem 1.2vh 2.5rem}.grupo i{left:.8rem}.tgPass{right:.8rem!important}.btnAuth{padding:1.5vh 4vw;font-size:.95rem}#registroForm{display:flex;flex-direction:column;gap:1.5vh}}.grupoCheck label{display:flex;align-items:center;gap:.8vh;font-size:.9rem;color:var(--tx);}.grupoCheck input[type="checkbox"]{width:16px;height:16px;accent-color:var(--mco);cursor:pointer;}.grupoCheck a{color:var(--mco);text-decoration:underline;}.authMod h2,.authMod a,.authMod input::placeholder,.authMod i,.authMod span{color:var(--bg2);}.authMod input:focus::placeholder,.authMod input:focus{color:var(--mco)}`;let C=!1;const L=()=>{C||(o("body").append(Object.values(Y).join("")),C=!0,R())};!o(".wiAuthCss").length&&o("head").append(`<style class="wiAuthCss">${z}</style>`);const A={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Usuario 4-20 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingrese nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingrese apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===o("#regPassword").val()||"No coinciden"]},R=()=>{let a=!1,s=!1,n=!1;o(document).off("click.wa",".tgPass").on("click.wa",".tgPass",function(){const r=o(this).siblings("input");r.attr("type",r.attr("type")==="password"?"text":"password"),o(this).toggleClass("fa-eye fa-eye-slash")}),o(document).off("input.wa","#regUsuario,#regEmail,#email,#recEmail").on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){o(this).val(o(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([r,e])=>{o(document).off("input.wa keyup.wa",r).on("input.wa keyup.wa",r,t=>{o(e).removeClass("inactivo"),t.key==="Enter"&&o(e).click()})}),Object.entries(A).forEach(([r,[e,t]])=>{o(document).off("blur.wa",`#${r}`).on("blur.wa",`#${r}`,function(){const i=e(o(this).val());o(this).val(i);const l=t(i);l!==!0&&h(this,l,"error",2500)})}),o(document).off("blur.wa focus.wa","#regUsuario").on("blur.wa focus.wa","#regUsuario",async function(){const r=o(this).val().trim();if(r.includes("@")){h(this,"Usuario no puede contener @","error",2500),a=!1;return}if(r.length>=3)try{const e=await v(p(u,c.db,r));a=!e.exists(),h(this,`Usuario ${e.exists()?"no disponible ❌":"disponible ✅"}`,a?"success":"error",3e3)}catch(e){console.error(e)}}),o(document).off("blur.wa focus.wa","#regEmail").on("blur.wa focus.wa","#regEmail",async function(){const r=o(this).val().trim();if(r.length>0&&!r.includes("@")){h(this,"Debe ser un email válido","error",2500),s=!1;return}if(r.length>=3&&r.includes("@"))try{const e=await j(I(O(u,c.db),S("email","==",r)));s=e.empty,h(this,`Email ${e.empty?"disponible ✅":"no disponible ❌"}`,s?"success":"error",3e3)}catch(e){console.error(e)}}),o(document).off("click.wa","#Registrar").on("click.wa","#Registrar",async function(){if(n)return;if(!o("#regTerminos").is(":checked")){h(o("#regTerminos")[0],"Debes aceptar los términos y condiciones","error",2500);return}n=!0,g(this,!0,"Registrando");const r=[[a,o("#regUsuario")[0],"Usuario no disponible"],[s,o("#regEmail")[0],"Email no disponible"],...Object.entries(A).map(([e,[t,i]])=>{const l=o(`#${e}`),M=t(l.val()),m=i(M);return[m===!0,l[0],m!==!0?m:""]})];for(const[e,t,i]of r)if(!e&&i){g(this,!1),h(t,i,"error",2500),t.focus(),n=!1;return}try{const[e,t,i,l,M]=["regEmail","regUsuario","regNombre","regApellidos","regPassword"].map(E=>o(`#${E}`).val().trim()),{user:m}=await B(y,e,M);await Promise.all([D(m,{displayName:t}),N(m)]);const P={usuario:t,email:e,nombre:i,apellidos:l,rol:c.rol,uid:m.uid,terminos:!0,tema:localStorage.wiTema};await $(p(u,c.db,t),{...P,creado:U()}),(await _(async()=>{const{personal:E}=await import("./header-CYlTcYE_.js");return{personal:E}},__vite__mapDeps([0,1,2,3,4]))).personal(P)}catch(e){b({"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil"}[e.code]||e.message,"error"),console.error(e)}finally{g(this,!1),n=!1}}),o(document).off("click.wa","#Login").on("click.wa","#Login",async function(){g(this,!0,"Iniciando");try{const[r,e]=["#email","#password"].map(l=>o(l).val().trim());let t=r;if(!r.includes("@")){const l=await v(p(u,c.db,r));if(!l.exists())throw new Error("Usuario no encontrado");t=l.data().email}await F(y,t,e);const i=t.includes("@")?(await v(p(u,c.db,y.currentUser.displayName))).data():(await v(p(u,c.db,r))).data();i.tema&&(localStorage.wiTema=i.tema,T(i.tema)),W("wiSmile",i,450),x("loginModal")}catch(r){b({"auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado"}[r.code]||r.message,"error"),console.error(r)}finally{g(this,!1)}}),o(document).off("click.wa","#Recuperar").on("click.wa","#Recuperar",async function(){g(this,!0,"Enviando");try{const r=o("#recEmail").val().trim();let e=r;if(!r.includes("@")){const t=await v(p(u,c.db,r));if(!t.exists())throw new Error("Usuario no encontrado");e=t.data().email}await q(y,e),b("✅ Email enviado para restablecer contraseña","success")}catch(r){b(r.message||"Error al enviar email","error"),console.error(r)}finally{g(this,!1)}});const f={crearCuenta:()=>{w("registroModal"),x("loginModal")},conCuenta:()=>{w("loginModal"),x("registroModal")},olvidastePass:()=>{w("recuperarModal"),x("loginModal")},volverLogin:()=>{w("loginModal"),x("recuperarModal")}};o(document).off("click.wa",".crearCuenta,.conCuenta,.olvidastePass,.volverLogin").on("click.wa",".crearCuenta,.conCuenta,.olvidastePass,.volverLogin",function(){f[o(this).attr("class").split(" ")[0]]()})};o(document).off("click.wa",".login,.registrar").on("click.wa",".login,.registrar",function(a){a.preventDefault(),L(),setTimeout(()=>w(o(this).hasClass("login")?"loginModal":"registroModal"),100)});function T(a){if(!a)return;const[s,n]=a.split("|");document.documentElement.dataset.theme=s,o('meta[name="theme-color"]').attr("content",n),o(".tema").removeClass("mtha").filter(`[data-ths="${a}"]`).addClass("mtha")}o(document).off("click.wa",".tema").on("click.wa",".tema",async function(){const a=localStorage.wiTema,s=V("wiSmile"),n=a.split("|")[0];if(s)try{await $(p(u,c.db,s.usuario),{tema:a,actualizado:U()},{merge:!0}),b(`Tema ${n} Guardado ✅`)}catch(f){console.error(f)}})}X();export{y as auth,oa as onAuthStateChanged,ea as signOut,X as wiAuth};
